var mdns = require('mdns');
//.excludeInterface('0.0.0.0');
  var browser = mdns.createBrowser(mdns.tcp('googlecast'))
//doit modifier mdns avec 
function search(waitTime = 1000,callback) {

  var services = {}

  browser.start();
  browser.on('serviceUp', function(service){
	if(service.txtRecord.md == 'Google Home'){
		services[service.txtRecord.fn]=service.addresses[0];
		
	}
});
setTimeout(function(){callback(services); browser.stop()}, waitTime);
 
/*
  return services
    .filter(service => { if(service.txtRecord.md === 'Google Home') return service })
    .map(service => { return Object.assign(service.txtRecord, {address: service.addresses[0]}) })*/
}
/*
var mdns = require('mdns-js');
//if you have another mdns daemon running, like avahi or bonjour, uncomment following line
mdns.excludeInterface('0.0.0.0');
function search(waitTime = 1000,callback) {
var browser = mdns.createBrowser(mdns.tcp('googlecast'));

browser.on('ready', function () {
    browser.discover(); 
});

browser.on('update', function (data) {
    console.log('data:', data);

});
}
*/
module.exports = search
