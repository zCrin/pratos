var fs = require('fs');
var homepage = Object();
var finalHomepage = [];
var nbObjects = 0;
module.exports = {
	construct : function(plugins,callback){
	 	homepage = Object();
		finalHomepage = [];
		nbObjects = 0
		var pluginsName = Object.keys(plugins);
		var pluginsSize = pluginsName.length;
		if(pluginsSize == 0){
			callback(finalHomepage);
		}
		for(var u = 0; u < pluginsSize; u++){
			require(plugins[pluginsName[u]]).homepage(this);
			if(u == (pluginsSize - 1)){
				fs.readFile( __dirname + "/homepage_order.json", 'utf8', function(err, data){
					var data = JSON.parse(data),
						nbBox = data.order.length;
					for(var v = 0; v < nbBox; v++){
						if(nbBox > 0){
						if(homepage[data.order[v]]){ //finalHomepage[v][w] 
							finalHomepage[data.order[v]] = data.order[v];
							delete homepage[data.order[v]];
						}
					}
				}
					var pluginsName = Object.keys(homepage),
						pL = pluginsName.length;
					if(pL > 0){
						var lastRow = Object.keys(finalHomepage).length;
						for(var w =0; w < pL; w++){
							finalHomepage[pluginsName[w]] = homepage[pluginsName[w]];
						}
					}
					callback(finalHomepage);
				});
			}
		}
	},
	createBox:function(name, content, titled){
		homepage[nbObjects] = Object();
		homepage[nbObjects].name = name;
		homepage[nbObjects].show_name = titled;
		homepage[nbObjects].content = content;
		nbObjects++;
	}
}