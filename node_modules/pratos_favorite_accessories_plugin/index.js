const path = __dirname.replace('/node_modules/pratos_favorite_accessories_plugin', '');
var fs = require('fs');
var Cookies = require("cookies");
var User = require("pratos_user_class");
module.exports = {
	config:function(){
		var conf = Object();
		conf.GET = true;
		conf.on_content = true;
		return conf;
	},
	get:function(app, globalVariable){
		app.get('/favorite_accessory.js', function(req, res) {
			res.setHeader('Content-Type', 'application/javascript');
			fs.readFile( __dirname + '/favorite_accessory.js', 'utf8', function(err, data){
			res.end(data);
});
		});
		app.get('/favorite_accessory.list', function(req, res) {
			res.setHeader('Content-Type', 'application/json');
			fs.readFile( __dirname + '/favorite_accessory.list', 'utf8', function(err, data){
			res.end(data);
});
		});
		app.get('/toggle_favorite/', function(req, res) {
			globalVariable.cookies = new Cookies( req, res);
			globalVariable.request = req;
			User.verify_connection(globalVariable, function(user_res){
				if(user_res == true){
					if(globalVariable.request.query.aid){
aid = globalVariable.request.query.aid;
						fs.readFile( __dirname + '/favorite_accessory.list', 'utf8', function(err, data){
							var file = JSON.parse(data);
							var dataL = file.favorite_accessories.length;
							if(file.favorite_accessories.indexOf(aid) > -1){
								file.favorite_accessories.splice(file.favorite_accessories.indexOf(aid), 1);
							}
							else{
								file.favorite_accessories.push(aid);
							}
fs.writeFile( __dirname + '/favorite_accessory.list', JSON.stringify(file));
						res.redirect('/favorite_accessory.list');
						});
					}
					else{
						res.end("No aid provided");
					}
				}
				else{
					res.end("Not connected");
				}
			});
		});
	},
	content:function(link){
		link.push("<script src='/favorite_accessory.js'></script>");
		return link;
	}
};