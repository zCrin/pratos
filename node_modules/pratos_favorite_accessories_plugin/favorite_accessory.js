var urlSplitted = window.location.href.split('/');
var file = urlSplitted[(urlSplitted.length - 1)] || urlSplitted[(urlSplitted.length - 2)];
if(file == "manage_accessories"){
var all;
	$.getJSON( "/favorite_accessory.list", function( data ) {
		
		all = data.favorite_accessories;
		
$('.updating_page > #div2').after('<div id="addToFavoriteBlock" style="display: flex; justify-content: space-around; width: 40%;"><label>Favori :</label><i style="position: relative;  color: #F3E2A9; top: -4px; font-size: 1.7em;" class="fa fa-star-o" aria-hidden="true"></i></div>');
	});

$('body').on("click",'.update_object',function(){
$('#addToFavoriteBlock > i').off();
	var aidObject = $(this).parent().attr('id');
if(all.indexOf(aidObject) > -1){
$('#addToFavoriteBlock > i').removeClass("fa-star-o");
$('#addToFavoriteBlock > i').addClass("fa-star");
}else{
$('#addToFavoriteBlock > i').addClass("fa-star-o");
$('#addToFavoriteBlock > i').removeClass("fa-star");
}
$('#addToFavoriteBlock > i').click(function(){
	$.getJSON( "/toggle_favorite/?aid=" + aidObject, function( data ) {
		all = data.favorite_accessories;
$('#addToFavoriteBlock > i').toggleClass("fa-star-o");
$('#addToFavoriteBlock > i').toggleClass("fa-star");
});
});
});
}
else if(file == "index"){
var all_accessories = {},
 accessories = '',
form_display = '',
all = '';
	$.getJSON( "/favorite_accessory.list", function( data ) {
all = data.favorite_accessories;
list_access();
var t = setInterval(list_access, 10000);
});
function list_access(){
var accessories = '';
	$.getJSON( "/list_accessories/", function( data ) {
			 all_infos = data.accessories;
  			$.each( all_infos, function(key, val ){

if(all.indexOf(val.aid.toString()) > -1){
				all_accessories[val.aid] = val;
				var class_attr = 'accessory-buttons ' + form_display + ' ', img = false;
				if(val.state.length == 0){
					val.state = 0;
				}
				
				
					if(val.state == 1){
						class_attr += "accessory_on ";
						
					}
					

				accessories += '<div style="width: 88%;padding: 1% 1%;margin: 2% auto 1% auto;flex-direction: row-reverse;justify-content: space-between;border-radius: 6px;min-height: initial;" ';
				if(val.iid != "" && !(/Sensor/).test(val.category)){
					accessories += 'onClick="change_f_statut('+ val.aid + ')" iid="'+ val.iid + '" ';
				} 
				accessories += 'class="'+ class_attr + '" id="'+ val.aid + '">';
				
				
					if(val.category == "Temperature Sensor"){
						val.state = Math.round(val.state) + " \260C";
accessories += '<div>' + val.state+ '</div>';
					}
					else{
accessories += '<div> </div>';
}
	


				
				accessories += '<span id="accessory_name">' + val.name + '</span></div>';
}
		});

				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0;'>" + accessories + "</div>");

	});
}

function change_f_statut(aid){
	

		var newState;
		if(all_accessories[aid].state_format == 'bool'){
			newState = (all_accessories[aid].state - 1) *  (all_accessories[aid].state - 1);
			all_accessories[aid].state = newState;
		
		

			var url  = "/change_state/?aid=" + aid + "&iid="+ all_accessories[aid].iid + "&value=" + newState;
			$.getJSON(url, function( data ) {			$('#' + aid).toggleClass('accessory_on');});


}
		}
	
}
