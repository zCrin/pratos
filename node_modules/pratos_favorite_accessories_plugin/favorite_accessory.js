var urlSplitted = window.location.href.split('/');
var file = urlSplitted[(urlSplitted.length - 1)] || urlSplitted[(urlSplitted.length - 2)];
var global_color=$("h1").css("color");
if(file == "manage_accessories"){
var all;
	$.getJSON( "/favorite_accessory.list", function( data ) {
		
		all = data.favorite_accessories;
		
$('.updating_page > #div2').after('<div id="addToFavoriteBlock" style="display: flex; justify-content: space-around; width: 40%;"><label>Favori :</label><i style="position: relative;  color: #F3E2A9; top: -4px; font-size: 1.7em;" class="fa fa-star-o" aria-hidden="true"></i></div>');
	});

$('body').on("click",'.update_object',function(){
$('#addToFavoriteBlock > i').off();
	var aidObject = $(this).parent().attr('id');
if(all.indexOf(aidObject) > -1){
$('#addToFavoriteBlock > i').removeClass("fa-star-o");
$('#addToFavoriteBlock > i').addClass("fa-star");
}else{
$('#addToFavoriteBlock > i').addClass("fa-star-o");
$('#addToFavoriteBlock > i').removeClass("fa-star");
}
$('#addToFavoriteBlock > i').click(function(){
	$.getJSON( "/toggle_favorite/?aid=" + aidObject, function( data ) {
		all = data.favorite_accessories;
$('#addToFavoriteBlock > i').toggleClass("fa-star-o");
$('#addToFavoriteBlock > i').toggleClass("fa-star");
});
});
});
}
else if(file == "index"){
var loadedSlick=0;
var all_accessories = {},
 accessories = '',
form_display = '',
all = '';
	$.getJSON( "/favorite_accessory.list", function( data ) {
all = data.favorite_accessories;
list_access();

});

function list_access(){


var socket = io.connect("//" + document.domain,{secure:true, ciphers: 'DES-CBC3-SHA'});
var lastReceived;
 socket.on('connect', function(data) {
socket.emit('sendAccessoriesList');
setInterval(function(){socket.emit('accessoriesRequest');},1000);
	socket.on('accessoriesList', function(data) {
var accessories = '';

data = JSON.parse(data);

all_infos = data.accessories;
  			$.each( all_infos, function(key, val ){
				all_accessories[val.aid] = val;
				var class_attr = 'accessory-buttons ' + form_display + ' ', img = false;
				
				
				
				var accessoriesUniq = '<div ';
if(val.state_format != 'float'){
					if(val.state == 1){
						accessoriesUniq += ' style="width: 88%;padding: 1% 1%; margin: 2% auto 1% auto; font-size:140%;text-align:left;border-radius: 6px; min-height:0; border:1px solid '+ global_color+'; color:'+ global_color+';" '
						
						
					}
else{
						
							accessoriesUniq += ' style="width: 88%;padding: 1% 1%; margin: 2% auto 1% auto; font-size:140%;text-align:left;border-radius: 6px; min-height:0;border:1px solid #D8D8D8 ;color: #D8D8D8;"';
						
				}
				
}
					else{
						
							accessoriesUniq += ' style="width: 88%;padding: 2% 1%; justify-content: space-between; margin: 1% auto 1% auto; font-size:140%;text-align:left;border-radius: 6px; min-height:0; color: #D8D8D8; display:flex; flex-direction: row ;border:1px solid #D8D8D8;"';
						
				}
				
				
				if(val.iid != "" && !(/Sensor/).test(val.category)){
					accessoriesUniq += 'onClick="change_f_statut('+ val.aid + ')" iid="'+ val.iid + '" ';
				} 
				accessoriesUniq += 'class="'+ class_attr + '" id="'+ val.aid + '">';

				if(val.category == "Temperature Sensor"){
						
var stateAccess = '<div style="font-size:100%">' + val.state+ '</div>';
					}
					else{
var stateAccess = '';
}
				accessoriesUniq += '<span style="margin-top:0;"id="accessory_name">' + val.name + '</span>'+ stateAccess+'</div>';
if(all.indexOf(val.aid.toString()) > -1){
accessories += accessoriesUniq;
}
	});




if(corres){
if(corres.length == 1){
				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0; display:flex; flex-direction:column;'>" + accessories + "</div>");
}
else{
if(! loadedSlick){
setTimeout(function(){$('#slick-slide0'+corres['Accessoires_Favoris'] + ' > .content'). html("<div style='padding: 2% 0; display:flex;flex-direction:column;'>" + accessories + "</div>"); loadedSlick=1;},3000);
}else{
$('#slick-slide0'+corres['Accessoires_Favoris'] + ' > .content'). html("<div style='padding: 2% 0; display:flex;flex-direction:column;'>" + accessories + "</div>"); 
}
}
}else{
				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0; display:flex; flex-direction:column;'>" + accessories + "</div>");}

	
});
});
/*
	$.getJSON( "/list_accessories/", function( data ) {
			 all_infos = data.accessories;
  			$.each( all_infos, function(key, val ){

if(all.indexOf(val.aid.toString()) > -1){
				all_accessories[val.aid] = val;
				var class_attr = 'accessory-buttons ' + form_display + ' ', img = false;
				if(val.state.length == 0){
					val.state = 0;
				}
				
				
					if(val.state == 1){
						class_attr += "accessory_on ";
						
					}
					

				accessories += '<div style="width: 88%;padding: 1% 1%;margin: 2% auto 1% auto;flex-direction: row-reverse;justify-content: space-between;border-radius: 6px;min-height: initial;" ';
				if(val.iid != "" && !(/Sensor/).test(val.category)){
					accessories += 'onClick="change_f_statut('+ val.aid + ')" iid="'+ val.iid + '" ';
				} 
				accessories += 'class="'+ class_attr + '" id="'+ val.aid + '">';
				
				
					if(val.category == "Temperature Sensor"){
						
accessories += '<div>' + val.state+ '</div>';
					}
					else{
accessories += '<div> </div>';
}
	


				
				accessories += '<span id="accessory_name">' + val.name + '</span></div>';
}
		});

if(corres){
if(corres.length == 1){
				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0;'>" + accessories + "</div>");
}
else{
setTimeout(function(){$('#slick-slide0'+corres['Accessoires_Favoris'] + ' > .content'). html("<div style='padding: 2% 0;'>" + accessories + "</div>");},3000);
}
}else{
				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0;'>" + accessories + "</div>");}

	});
}
[{[]]][]
var socket = io.connect("http://" + document.domain);
var lastReceived;
 socket.on('connect', function(data) {
alert(data);
setInterval(function(){socket.emit('accessoriesRequest');},1000);
    socket.emit('sendAccessoriesList');
	socket.on('accessoriesList', function(data) {
lastReceived = JSON.parse(data);
               show_accessories(lastReceived);
        });
 });
function show_accessories(data){
var room = localStorage.getItem('room');

var accessories = '';
all_infos = data.accessories;
  			$.each( all_infos, function(key, val ){
				all_accessories[val.aid] = val;
				var class_attr = 'accessory-buttons ' + form_display + ' ', img = false;
				
				
				
				if(val.state_format != 'float'){
					if(val.state == 1){
						class_attr += "accessory_on ";
						if(val.icon_on){
							img = val.icon_on;
						}
						
					}
					else{
						if(val.icon_off){
							img = val.icon_off;
						}
						}
				}
				
				var accessoriesUniq = '<div ';

				if(val.iid != "" && !(/Sensor/).test(val.category)){
					accessoriesUniq += 'onClick="change_statut('+ val.aid + ')" iid="'+ val.iid + '" ';
				} 
				accessoriesUniq += 'class="'+ class_attr + '" id="'+ val.aid + '">';

				if(img){
					var img_style = '';
					if(form_display == "accessory-buttons_list"){
						img_style = "style='margin:0'";
					}
					accessoriesUniq += '<img ' + img_style + ' src="' + img +'"/>';
				}
				else{
					
					accessoriesUniq += '<div>' + val.state + '</div>';

				}
				accessoriesUniq += '<span id="accessory_name">' + val.name + '</span><span onClick="update_accessory(' + val.aid + ')" class="update_object"><i class="fa fa-pencil" aria-hidden="true"></i></span></div>';
if(room == 'all' || room == null|| val.room == room){
accessories += accessoriesUniq;
}
		});

if(corres){
if(corres.length == 1){
				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0;'>" + accessories + "</div>");
}
else{
setTimeout(function(){$('#slick-slide0'+corres['Accessoires_Favoris'] + ' > .content'). html("<div style='padding: 2% 0;'>" + accessories + "</div>");},3000);
}
}else{
				$('#Accessoires_Favoris_plugin > .content').html("<div style='padding: 2% 0;'>" + accessories + "</div>");}

	});
*/
}
function change_f_statut(aid){
	

		var newState;
		if(all_accessories[aid].state_format == 'bool'){
$('#' + aid).toggleClass('accessory_on');
			newState = (all_accessories[aid].state - 1) *  (all_accessories[aid].state - 1);
			all_accessories[aid].state = newState;
		
		

			var url  = "/change_state/?aid=" + aid + "&iid="+ all_accessories[aid].iid + "&value=" + newState;
			$.get(url);


}
		}
	
}