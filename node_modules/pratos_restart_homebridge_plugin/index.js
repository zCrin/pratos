const path = __dirname.replace('/node_modules/pratos_restart_homebridge_plugin', '');
var cmd=require('node-cmd');

var User = require("pratos_user_class");
module.exports = {
	config:function(){
		var conf = Object();
		conf.GET = true;
		conf.navbar = true;
		return conf;
	},
	get:function(app, globalVariable){
		app.get('/restart_homebridge/', function(req, res) {
			
			User.verify_connection(req.user_id,globalVariable, function(user_res){
				if(user_res == true){
					res.setHeader('Content-Type', 'application/json');
					cmd.get("sudo /etc/init.d/homebridge restart", function(out){
  						if(out){
							res.redirect('/admin/index/');
						}
					});
				}
				else{
					res.redirect('/');
				}
			});
		});
	},
	navbar:function(nav){
		nav.create_default_link("Relancer Homebridge", '<i class="fa fa-refresh" aria-hidden="true"></i>', '/restart_homebridge/');
	}
};