const path = __dirname.replace('/node_modules/pratos_restart_homebridge_plugin', '');
var cmd=require('node-cmd');

var user = require(path+'/lib/users.js');
module.exports = {
	config:function(){
		var conf = Object();
		conf.GET = true;
		conf.navbar = true;
		conf.RecipeBlock = true;
		return conf;
	},
	get:function(app, globalVariable){
		app.get('/restart_homebridge/', function(req, res) {
			
		
       user.is_connected(req.user_id, function (response,user_res) {
			if (response == true) {
					res.setHeader('Content-Type', 'application/json');
					globalVariable.restart_homebridge(function(){
							res.redirect('/admin/index/');
						
					});
				}
				else{
					res.redirect('/');
				}
			});
		});
	},
	navbar:function(nav){
		nav.create_default_link("Relancer Homebridge", '<i class="fa fa-refresh" aria-hidden="true"></i>', '/restart_homebridge/');
	},
	jsBlockDef:"Blockly.Blocks['reboothomebridgeplugin'] = {init: function() {this.jsonInit(" + JSON.stringify({
  "type": "reboothomebridgeplugin",
  "message0": "restart Homebridge %1 %2",
  "args0": [
    {
      "type": "input_dummy"
    },
    {
      "type": "input_statement",
      "name": "NAME"
    }
  ],
  "previousStatement": null,
  "nextStatement": null,
  "colour": 150,
  "tooltip": "",
  "helpUrl": ""
}) + ");}};",
	jsBlockCode:` Blockly.JavaScript['reboothomebridgeplugin'] = function(block) {
  var statements_name = Blockly.JavaScript.statementToCode(block, 'NAME');
  // TODO: Assemble JavaScript into code variable.
  var code = "globalVariable.restart_homebridge(function(){\\n"+statements_name+"\\n});";
  return code;
};`,
	jsBlockXml:function(x){
		if(x["<category name=\"Homebridge\" colour=\"#6da55b\">"]){
			x["<category name=\"Homebridge\" colour=\"#6da55b\">"] += '<block type="reboothomebridgeplugin"></block>';
		}else{
			x["<category name=\"Homebridge\" colour=\"#6da55b\">"] = '<block type="reboothomebridgeplugin"></block>';
		}
		return x;
	}
};