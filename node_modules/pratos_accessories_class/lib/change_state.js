/*
* License MIT
* « Copyright © 2018, Pratos »
* v 1.3.0
* !!! In this update Homebridge accessories are no longer designated by their AID but by their name. Changing accessory name in Homebridge config.json might lose your datas.
*/
var fs = require('fs');
const path = __dirname.replace('/node_modules/pratos_accessories_class/lib', '');
var cmd=require('node-cmd');

module.exports=change_state;
function change_state(aid,iid,value,globalVariable, callback){
		globalVariable.event.emit("accessories", "state:changing",{aid, iid,value});

			fs.readFile(path + "/conf/settings.json", 'utf8', function(err, data){
				var homebridge = JSON.parse(data).homebridge;
				var command = 'curl -X PUT '+ homebridge.host +':'+ homebridge.port + '/characteristics --header "Content-Type:Application/json" --header "authorization:'+ homebridge.pin +'" --data "{\\\"characteristics\\\":[{\\\"aid\\\":' + aid + ',\\\"iid\\\":'+ iid + ',\\\"value\\\":'+ value +'}]}"';
				cmd.get(command, function(answer){
					globalVariable.event.emit("accessories", "state:changed",JSON.stringify(answer));
					return callback(answer);
				});
			});
		}