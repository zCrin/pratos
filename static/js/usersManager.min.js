 var addUserBox=!1;function startUserManager(e){$("#addUserButton").click(function(){if(addUserBox)addUserBox.openSetting();else new Settings({target:"#"+e+"_settingsPage",title:"Ajouter un utilisateur",content:"<div class='add_user_box'><div class='flex-edit_user_box'> <div class='input-edit_user_box'> <div class='first-input-edit_user_box'> <div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input placeholder='Pseudo' type='text' id='update_username' spellcheck='false'/> </div></div><div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input type='text' placeholder='Email' id='update_email' spellcheck='false'/></div></div></div></div><div id='passwordChangeTitle'>Mot de passe</div><div class='input-edit_user_box passwordEditBox'><div class='first-input-edit_user_box'> <div class='group-input-edit-box-password'><div class='input-div-box input-edit-username'><input type='password' placeholder='Nouveau' id='update_newPassword' spellcheck='false'/> </div></div><div class='group-input-edit-box-password'> <div class='input-div-box input-edit-username'> <input type='password' placeholder='Confirmer' id='update_confirmPassword' spellcheck='false'/></div></div></div><div id='admin-digicode-input'><input style=' margin-right: 25px;' class='delete_plugin_check' type='checkbox'/>Digicode (mot de passe à 6 chiffres)</div><div id='updatePasswordButton' class='material-design-normal-button' data-ripple='rgba(0,0,0, 0.3)'>Créer</div></div></div></div>",onLoad:function(e){addUserBox=e,$("div[box-id="+e.id+"]").hide(),e.openSetting()},onOpened:function(t){inputbottombar(),new MaterialPlaceholder(MaterialPlaceholderStandard("Pseudo","#update_username")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Email","#update_email")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Nouveau","#update_newPassword")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Confirmer","#update_confirmPassword")).load(),$("#updatePasswordButton").click(function(){var a=$("#update_username").val();if(""!=a.trim()){var i=$("#update_email").val();if(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(i).toLowerCase())){var r=$("#admin-digicode-input > input").is(":checked"),d=$("#update_newPassword").val();if(""!=d)if(r&&6==d.length&&/^\d+$/.test(d)||!r){var s=$("#update_confirmPassword").val();s==d?$.post("/admin_create_user/",{username:a,email:i,isDigitPassword:r,password:d,passwordConfirm:s},function(a){dealResponse(a,function(){Snackbar.show({text:"Utilisateur créé",pos:"top-center",showAction:!1}),$("#"+e+"_settingsPage > .settings_menu_button").remove(),get_users(e,function(){$("."+t+"_settingsBack").click()})},function(){Snackbar.show({text:"Erreur lors de la création",pos:"top-center",showAction:!0,actionText:"Aide",actionTextColor:"red",onActionClick:function(){getHelp(666)}})})}):(error_input("#update_newPassword","Les 2 mots de passe ne correspondent pas",661),error_input("#update_confirmPassword","Les 2 mots de passe ne correspondent pas",661))}else error_input("#update_newPassword","Format digicode invalide",660);else error_input("#update_newPassword","Mot de passe vide",666)}else error_input("#update_email","Email invalide",655)}else error_input("#update_username","Pseudo invalide",654)})}}).load()}),get_users(e)}function get_users(e,t){$("#"+e+"_settingsPage > .settings_menu_button").remove(),$.getJSON("/get_userList/",function(a){if(!a.error)for(var i=a.length,r=0;r<i;r++){var d=a[r];new Settings({target:"#"+e+"_settingsPage",title:(d.icon?"<img src='"+d.icon+"' class='user-manage-icon'/>":"<div class='user-manage-icon' style='background-color:#"+d.userID.substring(0,6)+";'></div>")+"<span class='user-manage-username'>"+d.userName+"</span>",boxName:"Modifier profil",content:"<div class='edit_user_box'> <div class='flex-edit_user_box'> <div style='position:relative;'><div class='img-edit_user_box' style='background-color:#"+d.userID.substring(0,6)+";'></div><div class='img-edit_user_box-button'><i class='fa fa-pencil' aria-hidden='true'></i><p>Editer</p></div></div><div class='input-edit_user_box'> <div class='first-input-edit_user_box'> <div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input placeholder='Pseudo' f='"+r+"' userID='"+d.userID+"'value='"+d.userName+"'  type='text' id='update_username' spellcheck='false'/> </div></div><div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input value='"+(d.email?d.email:"")+"' type='text' placeholder='Email' id='update_email' spellcheck='false'/> </div></div></div><div class='first-input-edit_user_box'><div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input value='"+(d.name?d.name:"")+"' type='text' placeholder='Nom' id='update_name' spellcheck='false'/> </div></div><div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input value='"+(d.surname?d.surname:"")+"' type='text' placeholder='Prénom' id='update_surname' spellcheck='false'/> </div></div></div><div class='first-input-edit_user_box'> <div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <input placeholder='Téléphone' value='"+(d.phone?d.phone:"")+"'  type='text' id='update_phone' spellcheck='false'/> </div></div><div class='group-input-edit-box'> <div class='input-div-box input-edit-username'> <div id='input-birthday-userEdit'> <span class='material-input-placeholder-birthday'>Date d'anniversaire</span> <div class='box-input-birthday-userEdit'> <div> <input value='"+(d.birthdayDay?d.birthdayDay:"")+"' placeholder='JJ' type='text' id='date-input-birthday-userEdit'/> </div></div><span class='separator-input-birthday-userEdit'>/</span> <div class='box-input-birthday-userEdit'> <div> <input value='"+(d.birthdayMonth?d.birthdayMonth:"")+"' placeholder='MM' id='month-input-birthday-userEdit' type='text'/> </div></div><span class='separator-input-birthday-userEdit'>/</span> <div id='year-input-birthday-userEdit' class='box-input-birthday-userEdit'> <div> <input type='text' value='"+(d.birthdayYear?d.birthdayYear:"")+"' placeholder='AAAA'/> </div></div></div></div></div></div><div id='updateUserInfoButton' class='material-design-normal-button'  data-ripple='rgba(0,0,0, 0.3)'>Sauvegarder</div></div><div id='passwordChangeTitle'>Mot de passe</div><div class='input-edit_user_box passwordEditBox'> <div class='first-input-edit_user_box'> "+(0==r?"<div class='group-input-edit-box-password'> <div class='input-div-box input-edit-username'> <input placeholder='Ancien' type='password' id='update_oldPassword' spellcheck='false'/> </div></div>":"")+"<div class='group-input-edit-box-password'> <div class='input-div-box input-edit-username'> <input type='password' placeholder='Nouveau' id='update_newPassword' spellcheck='false'/> </div></div><div class='group-input-edit-box-password'> <div class='input-div-box input-edit-username'> <input type='password' placeholder='Confirmer' id='update_confirmPassword' spellcheck='false'/> </div></div></div><div id='admin-digicode-input'><input  style='    margin-right: 25px;' class='delete_plugin_check' type='checkbox'>Digicode (mot de passe à 6 chiffres)</div><div id='updatePasswordButton' class='material-design-normal-button'  data-ripple='rgba(0,0,0, 0.3)'>Changer</div></div>"+(0==r?"":"<div id='banTitle'>"+(d.is_banned?"Cet utilisateur est verrouillé":"Cet utilisateur est déverrouillé")+"</div><div class='input-edit_user_box banBox'><div onClick='"+(d.is_banned?"unlockUser()":"lockUser()")+"' id='UserButton"+(d.is_banned?"Banned":"Unbanned")+"' class='material-design-normal-button'  data-ripple='rgba(0,0,0, 0.3)'>"+(d.is_banned?"Déverrouiller":"Verrouiller")+"</div></div>")+(0==r?"":"<div id='banTitle'>Supprimer</div><div class='input-edit_user_box banBox'><div onClick='deleteUser("+e+")' id='UserButtonDelete' class='material-design-normal-button'  data-ripple='rgba(0,0,0, 0.3)'>Supprimer</div></div>")+"</div></div>",onOpened:function(e){$("#update_username").attr("x",e),inputbottombar(),$("#updatePasswordButton").click(function(){var e=$("#admin-digicode-input > input").is(":checked"),t=$("#update_newPassword").val();if(""!=t)if(e&&6==t.length&&/^\d+$/.test(t)||!e){var a=$("#update_confirmPassword").val();if(a==t){var i="";0==$("#update_username").attr("f")&&(i=$("#update_oldPassword").val()),$.post("/admin_update_userPassword/",{userID:$("#update_username").attr("userID"),isDigitPassword:e,password:t,passwordConfirm:a,oldPassword:i},function(e){dealResponse(e,function(){Snackbar.show({text:"Mot de passe mis à jour",pos:"top-center",showAction:!1})})})}else error_input("#update_newPassword","Les 2 mots de passe ne correspondent pas",661),error_input("#update_confirmPassword","Les 2 mots de passe ne correspondent pas",661)}else error_input("#update_newPassword","Format digicode invalide",660);else error_input("#update_newPassword","Mot de passe vide",666)}),$("#updateUserInfoButton").click(function(){var t=$("#update_username").val();if(""!=t.trim()){var a=$("#update_email").val();if(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(a).toLowerCase())){var i=$("#update_phone").val(),r="";i&&(/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im.test(i)?r=i:error_input("#update_phone","Téléphone invalide",656));var d=$("#update_name").val(),s=""!=d?d:"",n=$("#update_surname").val(),o=""!=n?n:"",l=$("#date-input-birthday-userEdit").val(),u="";l&&(/^\d+$/.test(l)&&parseInt(l)<=31&&l.length<=2?u=l.length<2?"0"+l:l:error_input("#date-input-birthday-userEdit","Date d'anniversaire invalide",657));var p=$("#month-input-birthday-userEdit").val(),c="";p&&(/^\d+$/.test(p)&&parseInt(p)<=31&&p.length<=2?c=p.length<2?"0"+p:p:error_input("#month-input-birthday-userEdit","Mois d'anniversaire invalide",658));var v=$("#year-input-birthday-userEdit input").val(),h="";if(v){var m=(new Date).getFullYear();4==v.length&&parseInt(v)<=m&&parseInt(v)>=m-120?h=v:error_input("#year-input-birthday-userEdit input","Année d'anniversaire invalide",659)}$.post("/admin_update_user/",{userID:$("#update_username").attr("userID"),username:t,name:s,surname:o,phone:r,email:a,birthdayDay:u,birthdayMonth:c,birthdayYear:h},function(a){dealResponse(a,function(){Snackbar.show({text:"Données mises à jour",pos:"top-center",showAction:!1}),$("div[box-id="+e+"] > span").html(t)})})}else error_input("#update_email","Email invalide",655)}else error_input("#update_username","Pseudo invalide",654)}),new MaterialPlaceholder(MaterialPlaceholderStandard("Pseudo","#update_username")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Nom","#update_name")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Email","#update_email")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Prénom","#update_surname")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Téléphone","#update_phone")).load(),"0"==$("#update_username").attr("f")&&new MaterialPlaceholder(MaterialPlaceholderStandard("Ancien","#update_oldPassword")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Nouveau","#update_newPassword")).load(),new MaterialPlaceholder(MaterialPlaceholderStandard("Confirmer","#update_confirmPassword")).load(),new MaterialPlaceholder(MaterialPlaceholderStandardBirthday("JJ","#date-input-birthday-userEdit")).load(),new MaterialPlaceholder(MaterialPlaceholderStandardBirthday("MM","#month-input-birthday-userEdit")).load(),new MaterialPlaceholder(MaterialPlaceholderStandardBirthday("AAAA","#year-input-birthday-userEdit input")).load();var t="";$("#date-input-birthday-userEdit").keyup(function(){var e=$(this).val();if(/^\d+$/.test(e)&&parseInt(e)<=31||""==e)t=e,e.length>=2&&(t=e,$("#month-input-birthday-userEdit").focus());else e=$(this).val(t)});var a="";$("#month-input-birthday-userEdit").keyup(function(){var e=$(this).val();if(/^\d+$/.test(e)&&parseInt(e)<=12||""==e)a=e,e.length>=2&&(a=e,$("#year-input-birthday-userEdit input").focus());else e=$(this).val(a)});$("#year-input-birthday-userEdit input").keyup(function(){var e=$(this).val(),t=(new Date).getFullYear();if(/^\d+$/.test(e)||""==e)if(4==e.length)if(parseInt(e)>t||parseInt(e)<t-120)e=$(this).val("");else a=e;else if(e.length>4)e=$(this).val(a);else a=e;else e=$(this).val(a)}).focusout(function(){var e=$(this).val(),t=(new Date).getFullYear();if(4==e.length)if(parseInt(e)>t||parseInt(e)<t-120)e=$(this).val("");else a=e;else e=$(this).val("")})}}).load()}if(t)return t()})}function error_input(e,t,a){$(e).css({borderColor:"red",color:"red"}).focusin(function(){$(this).css({borderColor:"lightgrey",color:"black"})}),Snackbar.show({text:t,pos:"top-center",showAction:!0,actionText:"Aide",actionTextColor:"red",onActionClick:function(){getHelp(a)}})}function MaterialPlaceholderStandard(e,t){return{text:e,target:t,empty:"empty-input-userEdit",not_empty:"not_empty-input-userEdit"}}function MaterialPlaceholderStandardBirthday(e,t){return{text:e,target:t,empty:"empty-input-userEditBirthday",not_empty:"not_empty-input-userEditBirthday"}}function lockUser(){$.post("/admin_ban_user/",{userID:$("#update_username").attr("userID"),tries:4},function(e){dealResponse(e,function(){Snackbar.show({text:"Utilisateur déverrouillé",pos:"top-center",showAction:!1}),$("#banTitle").text("Cet utilisateur est verrouillé"),$(".banBox").html("<div id='UserButtonBanned' class='material-design-normal-button'  onClick='unlockUser()' data-ripple='rgba(0,0,0, 0.3)'>Déverrouiller</div>")})})}function unlockUser(){$.post("/admin_unban_user/",{userID:$("#update_username").attr("userID")},function(e){dealResponse(e,function(){Snackbar.show({text:"Utilisateur déverrouillé",pos:"top-center",showAction:!1}),$("#banTitle").text("Cet utilisateur est déverrouillé"),$(".banBox").html("<div id='UserButtonUnbanned' class='material-design-normal-button'  onClick='lockUser()' data-ripple='rgba(0,0,0, 0.3)'>Verrouiller</div>")})})}function dealResponse(e,t,a){switch(e){case"true":t();break;case"Unauthorized access":Snackbar.show({text:"Seul l'admin peut réaliser cette action",pos:"top-center",showAction:!0,actionText:"Aide",actionTextColor:"red",onActionClick:function(){getHelp(663)}});break;case"Not connected":window.location="/";break;default:a?a():Snackbar.show({text:"Erreur lors de la modification",pos:"top-center",showAction:!0,actionText:"Aide",actionTextColor:"red",onActionClick:function(){getHelp(662)}});break;case"emptyEU":error_input("#update_email","Email et/ou pseudo invalide(s)",667),error_input("#update_username","Email et/ou pseudo invalide(s)",667);break;case"notDigit":error_input("#update_newPassword","Format digicode invalide",660);break;case"unmatching":error_input("#update_newPassword","Les 2 mots de passe ne correspondent pas",661),error_input("#update_confirmPassword","Les 2 mots de passe ne correspondent pas",661);break;case"oldPasswordWrong":error_input("#update_oldPassword","L'ancien mot de passe est incorrect",664);break;case"empty":error_input("#update_newPassword","Mot de passe vide",666)}}function deleteUser(e){var t=new MaterialPopup({name:"Supprimer",content:"<p>Voulez-vous vraiment supprimer cet utilisateur ? <br /> Cette action est définitive et toutes les données de cet utilisateur seront perdues.</p><div id='manageRoomButtonBar'><button id='cancelUserDeletionButton' data-ripple='rgba(0,0,0, 0.3)' class='material-design-normal-button'>Annuler</button><button id='deleteUserValidatebutton' class='material-design-normal-button' data-ripple='rgba(0,0,0, 0.3)'>Supprimer</button></div>",onLoad:function(){$("#cancelUserDeletionButton").click(function(){t.close()}),$("#deleteUserValidatebutton").click(function(){$.post("/admin_delete_user/",{userID:$("#update_username").attr("userID")},function(a){dealResponse(a,function(){Snackbar.show({text:"Utilisateur supprimé",pos:"top-center",showAction:!1}),get_users(e,function(){var e=$("#update_username").attr("x");$("."+e+"_settingsBack").click(),t.close()})})})})}});t.load()}